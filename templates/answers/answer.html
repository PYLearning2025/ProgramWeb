{% extends "base.html" %}
{% load static %}

{% block title %}{{ question.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/answers/answer.css' %}">
{% endblock %}

{% block extra_js %}
<script>
  let existingAnswerData = "{{ answer.answer|escapejs }}";
  let isAlreadySubmitted = "{{ already_submitted }}";
</script>
<script src="{% static 'js/answers/answer.js' %}"></script>
{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-grow-1">
  <div class="container-fluid main-container py-3 flex-grow-1">
    <div class="answer-toolbar d-flex justify-content-center pb-3">
      <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary" id="debug-btn">
          <i class="bi bi-bug-fill"></i> Debug
        </button>
        {% if not already_submitted %}
        <button type="submit" class="btn btn-outline-success" form="answerForm">
          <i class="bi bi-upload"></i> Submit
        </button>
        {% else %}
        <button type="button" class="btn btn-outline-success" disabled>
          <i class="bi bi-check-circle"></i> Submit
        </button>
        {% endif %}
      </div>
    </div>
    <div class="row align-items-stretch" style="overflow-y: hidden;">
      <div class="col-md-6 d-flex flex-column">
        <div class="card bg-white h-100">
          <div class="card-body">
            <h4 class="fw-bold text-primary mb-3">{{ question.title }}</h4>
            <p class="text-secondary mb-4" style="line-height:1.8;">{{ question.content|linebreaksbr }}</p>
            <div class="mb-3">
              <div class="fw-semibold text-info mb-1">輸入格式</div>
              <div class="bg-light p-3 rounded mb-2">{{ question.input_format|linebreaksbr }}</div>
            </div>
            <div class="mb-3">
              <div class="fw-semibold text-info mb-1">輸出格式</div>
              <div class="bg-light p-3 rounded mb-2">{{ question.output_format|linebreaksbr }}</div>
            </div>
            <div class="mb-3">
              <div class="fw-semibold text-success mb-1">輸入範例</div>
              <div class="bg-white border p-3 rounded mb-2">
                <pre class="mb-0">{{ question.input_example|linebreaksbr }}</pre>
              </div>
            </div>
            <div class="mb-3">
              <div class="fw-semibold text-success mb-1">輸出範例</div>
              <div class="bg-white border p-3 rounded mb-2">
                <pre class="mb-0">{{ question.output_example|linebreaksbr }}</pre>
              </div>
            </div>
            {% if question.hint %}
            <div class="mb-3">
              <div class="fw-semibold text-warning mb-1">提示</div>
              <div class="alert alert-warning mb-0">{{ question.hint }}</div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col-md-6 d-flex flex-column">
        <div class="card bg-white rounded-4 h-100">
          <div class="card-body d-flex flex-column h-100">
            <h4 class="fw-bold text-success mb-3">Code</h4>
            <form id="answerForm" method="post" class="flex-grow-1 d-flex flex-column">
              {% csrf_token %}
              <input type="hidden" name="question_id" id="question_id" value="{{ question.id }}">
              <div id="monaco-editor-container" class="flex-grow-1 d-flex flex-column">
                <div id="monaco-editor" class="flex-grow-1"></div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 送出確認 Modal -->
<div class="modal fade" id="submitConfirmModal" tabindex="-1" aria-labelledby="submitConfirmModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg border-0">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title d-flex align-items-center gap-2 fw-bold text-danger" id="submitConfirmModalLabel">
          <i class="bi bi-exclamation-triangle-fill me-1"></i> 送出確認
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center py-4">
        <div class="alert alert-warning d-flex align-items-center justify-content-center mb-0" role="alert"
          style="font-size:1.15rem;">
          <i class="bi bi-exclamation-circle-fill me-2"></i>
          <span>確定要送出答案嗎？</span>
        </div>
      </div>
      <div class="modal-footer border-0 pt-0 d-flex justify-content-center gap-3">
        <button type="button" class="btn btn-outline-secondary btn-lg px-4" data-bs-dismiss="modal">取消</button>
        <button type="button" class="btn btn-success btn-lg px-4" id="modal-submit-btn">確定送出</button>
      </div>
    </div>
  </div>
</div>

<!-- Debug 結果 Modal -->
<div class="modal fade" id="debugResultModal" tabindex="-1" aria-labelledby="debugResultModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg border-0">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title d-flex align-items-center gap-2 fw-bold" id="debugResultModalLabel">
          <i class="bi bi-bug-fill me-1"></i> Debug 結果
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body py-4">
        <div class="row">
          <!-- 左邊：測試結果和說明 -->
          <div class="col-md-6">
            <div class="mb-3">
              <h6 class="fw-semibold text-primary mb-2">
                <i class="bi bi-trophy-fill me-1"></i> 測試結果
              </h6>
              <div id="debug-status" class="alert mb-0 d-flex align-items-center justify-content-center" style="font-size: 1.1rem; font-weight: 600;"></div>
            </div>
            <div class="mb-3">
              <h6 class="fw-semibold text-secondary mb-2">
                <i class="bi bi-info-circle-fill me-1"></i> 結果說明
              </h6>
              <div id="debug-result" class="bg-light p-3 rounded border" style="max-height: 200px; overflow-y: auto;">
                <pre class="mb-0" style="font-size: 0.85rem;"></pre>
              </div>
            </div>
          </div>
          
          <!-- 右邊：輸入輸出範例 -->
          <div class="col-md-6">
            <div class="mb-3">
              <h6 class="fw-semibold text-info mb-2">
                <i class="bi bi-arrow-right-circle-fill me-1"></i> 輸入範例
              </h6>
              <div id="debug-inputs" class="bg-light p-3 rounded border" style="max-height: 150px; overflow-y: auto;"></div>
            </div>
            <div class="mb-3">
              <h6 class="fw-semibold text-success mb-2">
                <i class="bi bi-arrow-left-circle-fill me-1"></i> 期望輸出
              </h6>
              <div id="debug-outputs" class="bg-light p-3 rounded border" style="max-height: 150px; overflow-y: auto;"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer border-0 pt-0 d-flex justify-content-center">
        <button type="button" class="btn btn-primary btn-lg px-4" data-bs-dismiss="modal">關閉</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}